<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Health System Tests</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #1a1a1a;
            color: #ffffff;
        }

        .test-result {
            margin: 10px 0;
            padding: 10px;
            border-radius: 5px;
        }

        .test-pass {
            background-color: #2d5a2d;
            border: 1px solid #4a8a4a;
        }

        .test-fail {
            background-color: #5a2d2d;
            border: 1px solid #8a4a4a;
        }

        .test-summary {
            margin-top: 20px;
            padding: 15px;
            background-color: #2a2a2a;
            border-radius: 5px;
        }

        h1 {
            color: #00ffff;
        }

        h2 {
            color: #ffff00;
        }
    </style>
</head>

<body>
    <h1>Health System Unit Tests</h1>
    <div id="test-results"></div>
    <div id="test-summary" class="test-summary"></div>

    <script>
        // Simple test framework
        class TestRunner {
            constructor() {
                this.tests = [];
                this.results = [];
            }

            test(name, testFunction) {
                this.tests.push({ name, testFunction });
            }

            run() {
                this.results = [];
                const resultsDiv = document.getElementById('test-results');
                resultsDiv.innerHTML = '';

                this.tests.forEach(({ name, testFunction }) => {
                    try {
                        testFunction();
                        this.results.push({ name, passed: true, error: null });
                        this.displayResult(name, true, null);
                    } catch (error) {
                        this.results.push({ name, passed: false, error: error.message });
                        this.displayResult(name, false, error.message);
                    }
                });

                this.displaySummary();
            }

            displayResult(name, passed, error) {
                const resultsDiv = document.getElementById('test-results');
                const resultDiv = document.createElement('div');
                resultDiv.className = `test-result ${passed ? 'test-pass' : 'test-fail'}`;
                resultDiv.innerHTML = `
                    <strong>${passed ? '✓' : '✗'} ${name}</strong>
                    ${error ? `<br><small>Error: ${error}</small>` : ''}
                `;
                resultsDiv.appendChild(resultDiv);
            }

            displaySummary() {
                const summaryDiv = document.getElementById('test-summary');
                const passed = this.results.filter(r => r.passed).length;
                const total = this.results.length;
                const failed = total - passed;

                summaryDiv.innerHTML = `
                    <h2>Test Summary</h2>
                    <p><strong>Total Tests:</strong> ${total}</p>
                    <p><strong>Passed:</strong> ${passed}</p>
                    <p><strong>Failed:</strong> ${failed}</p>
                    <p><strong>Success Rate:</strong> ${((passed / total) * 100).toFixed(1)}%</p>
                `;
            }

            assert(condition, message) {
                if (!condition) {
                    throw new Error(message || 'Assertion failed');
                }
            }

            assertEqual(actual, expected, message) {
                if (actual !== expected) {
                    throw new Error(message || `Expected ${expected}, but got ${actual}`);
                }
            }

            assertTrue(condition, message) {
                if (!condition) {
                    throw new Error(message || 'Expected true, but got false');
                }
            }

            assertFalse(condition, message) {
                if (condition) {
                    throw new Error(message || 'Expected false, but got true');
                }
            }
        }

        // Mock canvas context for testing
        const mockCtx = {
            fillStyle: '',
            strokeStyle: '',
            lineWidth: 0,
            fillRect: function () { },
            strokeRect: function () { }
        };

        // Include the health system classes (simplified versions for testing)
        class HealthBar {
            constructor(width = 32, height = 4, offsetY = 8) {
                this.width = width;
                this.height = height;
                this.offsetY = offsetY;
                this.backgroundColor = '#333333';
                this.healthColors = {
                    high: '#00ff00',    // > 66%
                    medium: '#ffff00',  // 33-66%
                    low: '#ff0000'      // < 33%
                };
            }

            getHealthColor(healthPercentage) {
                if (healthPercentage > 0.66) {
                    return this.healthColors.high;
                } else if (healthPercentage > 0.33) {
                    return this.healthColors.medium;
                } else {
                    return this.healthColors.low;
                }
            }

            render(ctx, x, y, healthPercentage) {
                if (healthPercentage <= 0) return;
                // Mock rendering for tests
                return { x, y, healthPercentage, color: this.getHealthColor(healthPercentage) };
            }
        }

        class Enemy {
            constructor(x, y, type = 'basic') {
                this.x = x;
                this.y = y;
                this.width = 40;
                this.height = 30;
                this.speed = 2 + Math.random() * 2;

                this.type = type;
                this.setHealthByType(type);
                this.currentHealth = this.maxHealth;

                this.healthBar = new HealthBar(Math.floor(this.width * 0.8), 4, 8);
            }

            setHealthByType(type) {
                switch (type) {
                    case 'basic':
                        this.maxHealth = 1;
                        break;
                    case 'armored':
                        this.maxHealth = 3;
                        this.speed *= 0.7;
                        break;
                    case 'boss':
                        this.maxHealth = 10;
                        this.speed *= 0.5;
                        this.width = 60;
                        this.height = 45;
                        break;
                    default:
                        this.maxHealth = 1;
                }
            }

            takeDamage(amount = 1) {
                this.currentHealth -= amount;
                if (this.currentHealth <= 0) {
                    this.currentHealth = 0;
                    return true;
                }
                return false;
            }

            isDestroyed() {
                return this.currentHealth <= 0;
            }

            getHealthPercentage() {
                return this.currentHealth / this.maxHealth;
            }
        }

        // Initialize test runner
        const testRunner = new TestRunner();

        // Health System Tests
        testRunner.test('Enemy basic type has 1 health', () => {
            const enemy = new Enemy(100, 100, 'basic');
            testRunner.assertEqual(enemy.maxHealth, 1, 'Basic enemy should have 1 max health');
            testRunner.assertEqual(enemy.currentHealth, 1, 'Basic enemy should start with full health');
        });

        testRunner.test('Enemy armored type has 3 health', () => {
            const enemy = new Enemy(100, 100, 'armored');
            testRunner.assertEqual(enemy.maxHealth, 3, 'Armored enemy should have 3 max health');
            testRunner.assertEqual(enemy.currentHealth, 3, 'Armored enemy should start with full health');
        });

        testRunner.test('Enemy boss type has 10 health', () => {
            const enemy = new Enemy(100, 100, 'boss');
            testRunner.assertEqual(enemy.maxHealth, 10, 'Boss enemy should have 10 max health');
            testRunner.assertEqual(enemy.currentHealth, 10, 'Boss enemy should start with full health');
        });

        testRunner.test('Enemy takes damage correctly', () => {
            const enemy = new Enemy(100, 100, 'armored');
            const destroyed = enemy.takeDamage(1);
            testRunner.assertEqual(enemy.currentHealth, 2, 'Enemy should have 2 health after taking 1 damage');
            testRunner.assertFalse(destroyed, 'Enemy should not be destroyed after taking 1 damage');
        });

        testRunner.test('Enemy is destroyed when health reaches zero', () => {
            const enemy = new Enemy(100, 100, 'basic');
            const destroyed = enemy.takeDamage(1);
            testRunner.assertEqual(enemy.currentHealth, 0, 'Enemy should have 0 health after fatal damage');
            testRunner.assertTrue(destroyed, 'Enemy should be destroyed when health reaches zero');
            testRunner.assertTrue(enemy.isDestroyed(), 'isDestroyed() should return true');
        });

        testRunner.test('Enemy health percentage calculation', () => {
            const enemy = new Enemy(100, 100, 'armored');
            testRunner.assertEqual(enemy.getHealthPercentage(), 1.0, 'Full health should be 100%');

            enemy.takeDamage(1);
            testRunner.assertEqual(enemy.getHealthPercentage(), 2 / 3, 'Should be 66.7% after 1 damage');

            enemy.takeDamage(1);
            testRunner.assertEqual(enemy.getHealthPercentage(), 1 / 3, 'Should be 33.3% after 2 damage');
        });

        testRunner.test('Health bar color changes based on health percentage', () => {
            const healthBar = new HealthBar();

            testRunner.assertEqual(healthBar.getHealthColor(1.0), '#00ff00', 'Full health should be green');
            testRunner.assertEqual(healthBar.getHealthColor(0.7), '#00ff00', '70% health should be green');
            testRunner.assertEqual(healthBar.getHealthColor(0.5), '#ffff00', '50% health should be yellow');
            testRunner.assertEqual(healthBar.getHealthColor(0.2), '#ff0000', '20% health should be red');
        });

        testRunner.test('Boss enemy has larger size', () => {
            const basicEnemy = new Enemy(100, 100, 'basic');
            const bossEnemy = new Enemy(100, 100, 'boss');

            testRunner.assertTrue(bossEnemy.width > basicEnemy.width, 'Boss should be wider than basic enemy');
            testRunner.assertTrue(bossEnemy.height > basicEnemy.height, 'Boss should be taller than basic enemy');
        });

        testRunner.test('Armored enemy moves slower than basic enemy', () => {
            // Create multiple enemies to test speed difference (due to random factor)
            let basicSpeeds = [];
            let armoredSpeeds = [];

            for (let i = 0; i < 10; i++) {
                const basic = new Enemy(100, 100, 'basic');
                const armored = new Enemy(100, 100, 'armored');
                basicSpeeds.push(basic.speed);
                armoredSpeeds.push(armored.speed);
            }

            const avgBasicSpeed = basicSpeeds.reduce((a, b) => a + b) / basicSpeeds.length;
            const avgArmoredSpeed = armoredSpeeds.reduce((a, b) => a + b) / armoredSpeeds.length;

            testRunner.assertTrue(avgArmoredSpeed < avgBasicSpeed, 'Armored enemies should be slower on average');
        });

        testRunner.test('Multiple damage applications work correctly', () => {
            const enemy = new Enemy(100, 100, 'boss');

            // Apply damage multiple times
            for (let i = 0; i < 9; i++) {
                const destroyed = enemy.takeDamage(1);
                testRunner.assertFalse(destroyed, `Enemy should not be destroyed after ${i + 1} damage`);
            }

            // Final damage should destroy the enemy
            const destroyed = enemy.takeDamage(1);
            testRunner.assertTrue(destroyed, 'Enemy should be destroyed after 10 damage');
            testRunner.assertEqual(enemy.currentHealth, 0, 'Enemy should have 0 health');
        });

        // Run all tests when page loads
        window.addEventListener('load', () => {
            testRunner.run();
        });
    </script>
</body>

</html>